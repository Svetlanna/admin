!function(a){"use strict";if("undefined"!=typeof WPGlobusCoreData&&"undefined"!=typeof WPGlobusPlusAcf){var b={option:{language:WPGlobusCoreData.default_language,content:"",activeClass:"mce-active"},language:{},content:{},acfPro:!1,savedPost:!1,init:function(c){b.option=a.extend(b.option,c),"undefined"!=typeof WPGlobusAcf&&(b.acfPro=WPGlobusAcf.pro),b.addButtons(),b.acfPro?a(document).on("wpglobus_before_save_post",function(c,d){b.savedPost||(b.savedPost=!0,a.each(b.content,function(b,c){null==tinymce.get(b)||tinymce.get(b).isHidden()?(a("#"+b).val(c),a("#"+b+"-tmce").click()):tinymce.get(b).setContent(c,{format:"raw"})}))}):(b.setValidation(),a(document).on("wpglobus_before_save_post",function(c,d){acf.validation.disabled||acf.validation.run(),acf.validation.status&&a.each(b.content,function(a,b){tinymce.get(a).setContent(b)})})),b.editorsInit()},update:function(c){var d,e;"undefined"!=typeof c.target&&(d=c.target.id,"tinymce"==d&&(d=c.target.dataset.id),"undefined"!=typeof b.content[d]&&(e=null==tinymce.get(d)||tinymce.get(d).isHidden()?a("#"+d).val():tinymce.get(d).getContent({format:"raw"}),b.content[d]=WPGlobusCore.getString(b.content[d],e,b.language[d])))},editorsInit:function(){b.acfPro&&a(document).on("tinymce-editor-init",function(c,d){-1!=d.id.indexOf("acf-editor-")&&(d.on("nodechange keyup",_.debounce(b.update,1e3)),a("#"+d.id).on("input keyup",_.debounce(b.update,1e3)))})},setValidation:function(){acf.validation.disabled||a(document).on("acf/validate_field",function(b,c){var d,e=a(c),f="",g=!0;if(e.hasClass("field_type-textarea"))e.data("validation",!1),d=e.find("textarea").attr("id"),f=a("#"+d).val();else{if(!e.hasClass("field_type-text"))return;e.data("validation",!1),d=e.find("input").attr("id"),f=a("#"+d).val()}""!=f&&(f=WPGlobusCore.getTranslations(f),a.each(WPGlobusCoreData.enabled_languages,function(a,b){return""==f[b]?(g=!1,!1):void(g=!0)}),g?(e.data("validation",!0),a("#wpglobus-dialog-start-"+d).removeClass("wpglobus_dialog_error")):a("#wpglobus-dialog-start-"+d).addClass("wpglobus_dialog_error").shake(3,7,800))})},saveContent:function(a,c){var d;d=WPGlobusPlusAcf.removeEmptyP?a.getContent().replace(/<p>\s*<\/p>/g,""):a.getContent(),b.content[a.id]=WPGlobusCore.getString(b.content[a.id],d,c)},getTranslation:function(a,c){return WPGlobusCore.getTranslations(b.content[a.id])[c]},removeClass:function(c){a(".mce-wpglobus-plus-acf-button-"+c).removeClass(b.option.activeClass)},initContent:function(c){var d=a("#"+c.id).text(),e=WPGlobusCore.getTranslations(d);a.each(e,function(b,c){if(b!==WPGlobusCoreData.default_language){var f=e[b].split("\n\n");a.each(f,function(a,b){""!==b&&(f[a]="<p>"+b+"</p>")}),e[b]=f.join(""),d=WPGlobusCore.getString(d,e[b],b)}}),b.content[c.id]=d},addButtons:function(){tinymce.PluginManager.add("wpglobus_plus_acf_separator",function(a,b){a.addButton("wpglobus_plus_acf_separator",{text:"",icon:"wpglobus-plus-globe"})}),a.each(WPGlobusCoreData.enabled_languages,function(c,d){tinymce.PluginManager.add("wpglobus_plus_acf_button_"+d,function(c,e){var f="widget btn wpglobus-plus-acf-button",g="";(c.id.indexOf("wysiwyg-acf-field")>=0||c.id.indexOf("acf-editor-")>=0)&&d==WPGlobusCoreData.default_language&&(_.delay(function(){a(c.iframeElement).addClass("wpglobus-translatable").css({width:"99%"}),a("#"+c.id).addClass("wpglobus-translatable")},2e3),b.initContent(c),b.language[c.id]=b.option.language,a("#"+c.id).val(b.getTranslation(c,d)),g=" active",c.on("blur",function(a,d){b.saveContent(c,b.language[c.id])})),c.addButton("wpglobus_plus_acf_button_"+d,{text:WPGlobusCoreData.en_language_name[d],icon:!1,tooltip:"Select "+WPGlobusCoreData.en_language_name[d]+" language",value:d,classes:f+g+" wpglobus-plus-acf-button-"+d+" wpglobus-plus-acf-button-"+c.id,onclick:function(){var d=a(this),e=d[0]._id,f=WPGlobusCoreData.default_language;"undefined"!=typeof d[0]._value?f=d[0]._value:"undefined"!=typeof d[0].settings.value?f=d[0].settings.value:console.log("Language value not defined. It was set to default."),b.removeClass(c.id),a("#"+e).addClass(b.option.activeClass),b.saveContent(c,b.language[c.id]),b.language[c.id]=f,c.setContent(b.getTranslation(c,b.language[c.id]))}})})})}};WPGlobusPlusAcf=a.extend({},WPGlobusPlusAcf,b),WPGlobusPlusAcf.init()}}(jQuery);